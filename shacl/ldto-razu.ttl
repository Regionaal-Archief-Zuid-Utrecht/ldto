@prefix rdf:      <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix sh:       <http://www.w3.org/ns/shacl#> .
@prefix xsd:      <http://www.w3.org/2001/XMLSchema#> .
@prefix rdfs:     <http://www.w3.org/2000/01/rdf-schema#> .
@prefix owl:      <http://www.w3.org/2002/07/owl#> .
@prefix ldto:     <https://data.razu.nl/def/ldto/> .
@prefix ldto_sh:  <https://data.razu.nl/def/ldto-shacl/> .
@prefix ldto_esh: <https://data.razu.nl/def/ldto-extended-shacl/> .
@prefix skos:     <http://www.w3.org/2004/02/skos/core#> .
@prefix dcterms:  <http://purl.org/dc/terms/> .
@prefix premis:   <http://www.loc.gov/premis/rdf/v3/> .
@prefix schema:   <http://schema.org/> .

ldto_sh:razu 
    a owl:Ontology ;
    owl:imports ldto_sh:plus ;
    rdfs:label "LDTO plus SHACL shapes - with refs to RAZU terms" ;
    dcterms:creator <https://data.razu.nl/id/actor/2bdb658a032a405d71c19159bd2bbb3a> ;
    rdfs:comment "Nadere verfijning van de core shapes voor het RAZU toepassingsprofiel. Bevat verwijzingen naar termen uit thesauri van RAZU." .

###
# Enrichments to 'core':

ldto_sh:InformatieobjectShape
    sh:sparql [
        a sh:SPARQLConstraint ;
        sh:message "Voor aggregatieniveau 'archiefstuk' moeten er precies 2 ldto:beperkingGebruik zijn." ;
        sh:select """
            SELECT ?this
            WHERE {
              ?this a <https://data.razu.nl/def/ldto/Informatieobject> ;
                    <https://data.razu.nl/def/ldto/aggregatieniveau> <https://data.razu.nl/id/aggregatieniveau/96f7399fb1c5d3b7d2acdc48dac3d71e> .
              OPTIONAL {
                ?this <https://data.razu.nl/def/ldto/beperkingGebruik> ?bg .
              }
            }
            GROUP BY ?this
            HAVING (COUNT(?bg) != 2)
        """ ;
    ] .

###
# Enrichments to 'plus'

ldto_sh:InformatieobjectShape
    sh:sparql [
        a sh:SPARQLConstraint ;
        sh:message "ldto:dekkingInRuimte kan verplicht zijn, afhankelijk van ldto:classificatie." ;
        sh:select """
            SELECT ?this
            WHERE {
              ?this <https://data.razu.nl/def/ldto/classificatie> ?c .
              FILTER (?c IN (
                <https://data.razu.nl/id/soort/e7f8935f15730273e0b9ab9a0f74b2f8>  # krant / newspaper
              ))
              FILTER NOT EXISTS { ?this <https://data.razu.nl/def/ldto/dekkingInRuimte> ?dr . }
            }
        """ ;
    ] ;
    sh:sparql [
        a sh:SPARQLConstraint ;
        sh:message "ldto:isOnderdeelVan is verplicht, behalve als ldto:aggregatieniveau 'archief' is" ;
        sh:select """
            SELECT ?this
            WHERE {
                FILTER NOT EXISTS {
                    ?this <https://data.razu.nl/def/ldto/aggregatieniveau> <https://data.razu.nl/id/aggregatieniveau/62d05f1b8d586edb7da7f257be926705> .
                }
                FILTER NOT EXISTS {
                    ?this <https://data.razu.nl/def/ldto/isOnderdeelVan> ?parent .
                }
            }
        """ ;
    ] ;
    sh:sparql [
        a sh:SPARQLConstraint ;
        sh:message "schema:mainEntity kan verplicht zijn, afhankelijk van ldto:classificatie.." ;
        sh:select """
            SELECT ?this
            WHERE {
              ?this <https://data.razu.nl/def/ldto/classificatie> ?c .
              FILTER (?c IN (
                <https://data.razu.nl/id/soort/30d2cbfabc5d7cf795d3ddb00b1e8260>,
                <https://data.razu.nl/id/soort/e7f8935f15730273e0b9ab9a0f74b2f8>
              ))
              FILTER NOT EXISTS { ?this <http://schema.org/mainEntity> ?me . }
            }
        """ ;
    ] .
